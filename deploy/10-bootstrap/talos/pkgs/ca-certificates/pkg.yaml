name: ca-certificates
variant: scratch
shell: /bin/bash
dependencies:
  - stage: base
  - image: "{{ .TOOLS_PREFIX }}tools-ca-certificates:{{ .TOOLS_REV }}"
    to: /rootfs
steps:
  - sources:
      - url: https://raw.githubusercontent.com/SupaaHiro/schwifty-lab/refs/heads/master/deploy/10-bootstrap/pki/ca.pem
        destination: cacert.pem
        sha256: c4f2c8608d287eb9f80b00c76aaca46d9ac9156353b688d0185f7111f244452c
        sha512: 6fb0e06544122c120f8b2f0217210425eb6e4ea88e67d330841cec78a28785fb858676a422b73f97e492fae2998ff1e70888ed5ac7e4badf90551d8ff58ae2c7
    install:
      - |
        # Ensure the LOCAL_CA file exists
        if [ ! -f "cacert.pem" ]; then
          echo "Error: LOCAL_CA file 'cacert.pem' not found or not accessible." >&2
          exit 1
        fi

        cat "cacert.pem" >> "/rootfs/etc/ssl/certs/ca-certificates"
    test:
      - |
        fhs-validator /rootfs
finalize:
  - from: /rootfs
    to: /
